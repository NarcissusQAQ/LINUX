项目：基于select聊天室
时间：2019/6/10
作者：李锦龙

01.注册子系统分析 
这部分主要是需要与服务器建立连接，然后进入注册功能接口函数选项，将客户端发送来的消息录入保存到数据库中，然后需要向用户返回是否注册成功；如果失败，则返回注册/登录主菜单界面，重新选择注册选项（可以添加失败原因）；
数据库需要提前创建，其实从注册开始，就有了客户机与服务器之间的通信了，所以有关通信部分也需要提前创建，绑定；这些主要可以有三种不同的方式实现，即UDP， TCP 和 select；其中UDP不需要绑定；

02.登录子系统系统分析 
首先登录系统一定是已经注册过的用户才可以登录成功，所以先要与服务器建立连接，然后服务器接收客户 
端发送过来的登录信息，取出数据库的信息进行匹配，相同登录成功，不同登录失败。登录成功后，进入主菜单选项界面。（可以添加“密码错误”，“忘记密码”进行密码修改等）；

03.修改密码分析 
是需要一同修改数据库里的值，所以服务器端需要用到update，而登录的话需要服务器端创建一个全局链表来维持在线用户的信息处理，即登录成功后，需要向链表中添加相应的信息；

04.查看聊天室其他用户系统分析 
客户端登录成功后，选择私聊/群聊选项，进入私聊接口函数，进入此函数后，客户端需要向服务器发送一 
请求附近用户的消息，然后服务器响应，返回已登录好友的信息显示在私聊/群聊的窗口界面；

这个地方主要是需要之前登录时的链表信息；由于所有在线用户的信息都在链表中了，所以只需要通过对链表的访问就可以读取到当前在在线用户的信息了；

05.刷新功能分析 
这其实是一个小功能，因为是静态显示，所以需要通过刷新来更新显示的数据； 
有2种比较简单的方法可以实现：1.写一个延迟接口delay( )，有一定单片机基础的人都可以非常轻松的写 
出来，接下来如果不想要麻烦的话直接定时刷就行，如果想要花哨一点的，就可以通过信号来实现，每当有信号产生，则signal接受该信号，进入handel接口处理收到的信号，这里只需要alarm根据delay定时产生信号，handel中写上刷新函数就行；2.直接在你需要刷新内容前加上通信，即在显示这个信息之前都需要和服务器通信，以获得最新数据；

06.“悄悄话”子系统分析 
如果前面的功能都实现了的话这个其实很好写； 
这部分主要是逻辑需要清晰，首先主体部分是通信，即从命令行获取数据，发送给服务器，服务器收到信息后，与链表或者数据库进行核实部分数据，确定3件事发送者存在吗？数据合理吗？目标存在吗？这边有与需要向客户机返回服务器处理结果，所以设计大量判断，建议可以用switch使条理更清晰；

07.“群发消息“子系统分析 
大致与悄悄话一样，需要改动的就是目标对象，改为服务器在链表中寻找，找到一个，发送一条；

08.保存消息记录分析 
即对悄悄话内容和群发消息内容的保存，首先需要在悄悄话部分和群发消息部分调用该接口，获得信息存在 
一个结构体中，然后在把这个结构体存入文件中，这里需要用到系统调用中的文件函数或者c库中的文件编程，所以需要选择合适自己的打开文件方式，一个是a+b，一个是r；

09.会员相关功能分析 
会员说白了就是一个标志位，需要写入数据库中； 
踢人，禁言： 
这两个功能一起讲，是因为服务器在处理客户机发来与这两个功能相关的消息时，处理流程大致相同，首先 
判断该人是否会员，只有会员才能进行这2项操作；其次，判断禁言踢人对象不能是自己，这一步可能会被忽略， 
但是如果忽略的话，可能会导致bug；最后判断禁言踢人对象是否是会员，在线； 
不同点：禁言即让目标不能使用悄悄话和群发消息功能；踢人即让目标回到登录界面；

10.文件传输功能分析 
顾名思义，即让文件通过服务器，从一个客户机发送，再由另一个客户机接受；首先a客户机打开文件，读 
取内容到结构体中，发给服务器，服务器接收文件，转发给b客户机。这是一个大概流程； 
这里，需要思考一件事：你传输的文件是多大？如果很小的话一次就能传输结束了。如果比较大的话，就要分多次传输了。所以接受方打开文件方式就是a+b，那么问题来了，如果a连续传输了2个一样的文件给b的话，该文件是不是在b那边同名文件下写了2次；为了避免这个问题，我们需要在接受文件之前判断一下，先得到文件名，查找本地是否存在，不存在以a+b方式直接接收；存在则询问接收方是否覆盖？否，回到上一级菜单，是的话则以w方式接收；这样之前的问题就得到了很好的解决了。

11.删除聊天记录文件 
调用remove就行；

12.退出 
记得双方断开sockfd( UDP 无视)，和pthread_t tid;

13.视频传输-待补
配合opencv在c++的接口，实时传输。现视频传输功能做出来，但是cmake构建c和c++混合编译成一个执行文件有点麻烦，有时间补。
